{"version":3,"sources":["components/BottomMenu.module.css","App.module.css","utils/portsMapInfo.ts","hooks/useRepositories.ts","utils/cleanTimeSnapshot.ts","hooks/useTimeSnapshots.ts","utils/estimateCoordinatesAtTime.ts","utils/findIndexNearestTo.ts","models/TimeSnapshots.ts","utils/portIsTooClose.ts","components/CenterOnLocationChange.tsx","components/PatriMap.tsx","components/BottomMenu.tsx","App.tsx","models/TimeSnapshot.ts","reportWebVitals.ts","utils/mapFirebaseData.tsx","firebase/firebase.ts","config/firebase.ts","index.tsx","repositories/RepositoriesImpl.ts"],"names":["module","exports","portsMapInfo","id","country","city","position","lat","lng","RepositoriesContext","createContext","cleanTimeSnapshots","timeSnapshots","uniqueElementsBy","a","b","timestamp","sort","arr","fn","reduce","acc","v","some","x","push","useTimeSnapshots","localCache","localStorage","getItem","defaultValue","JSON","parse","useState","setTimeSnapshots","timeSnapshotsFromListener","setTimeSnapshotsFromListener","repositories","useContext","Error","useRepositories","useEffect","console","log","getLastTimeSnapshot","lastTimeSnapshot","getTimeSnapshots","cachedTimeSnapshots","subscribeToNewerLocations","Date","length","locations","effect","setItem","stringify","estimateCoordinatesAtTime","p2","p1","angle","distanceLatitude","distanceLongitude","Math","atan2","calculateAngle","distanceTraveledEstimation","distance","sqrt","pow","timeTookDistance","calculateSpeed","calculateDuration","cos","sin","binarySearch","middle","floor","lowerPart","slice","upperPart","findIndexNearestTo","element","indexOf","timeSnapshotsFindBoundingSnapshotsForTimestamp","self","date","index","findBoundingPointsForTimestamp","getTime","left","right","portIsTooClose","currentPosition","portPosition","CenterOnLocationChange","map","useMap","zoom","getZoom","setView","PatriIcon","L","icon","iconUrl","process","iconSize","iconAnchor","DestinationIcon","PatriMap","nextPortPosition","positions","MapContainer","center","TileLayer","attribution","url","Marker","Polyline","concat","MIN_TIME_RANGE","sleep","ms","Promise","r","setTimeout","BottomMenu","props","MAX_TIME_RANGE","now","isPlaying","setIsPlaying","className","styles","bottomMenu","menuContent","dates","toLocaleString","temperature","nextPort","type","min","max","value","onChange","e","parseInt","target","style","display","alignItems","gap","onClick","i","countDown","daysToPatri","patriDeparture","patriArrival","progress","overlay","PATRI_ARRIVAL_DATE","PATRI_DEPARTURE_DATE","DATS_TO_PATRI","differenceInDays","App","currentTimeSnapshot","setCurrentTimeSnapshot","polyLinePositions","s","timeSnapshotsGetPositions","filter","find","port","arrivalPortId","bounds","snapshot","other","time","coords","timeSnapshotEstimateAtTime","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","mapFirebaseData2","data","Object","values","lon","arrivalPort","lastPos","windTemperature","firebase1","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","analytics","firebase","locationsCollection","db","firestore","this","collection","orderBy","limit","get","querySnapshot","docs","el","newerLocations","default","afterDate","callback","where","onSnapshot","ReactDOM","render","StrictMode","Provider","document","getElementById"],"mappings":"4FACAA,EAAOC,QAAU,CAAC,WAAa,+BAA+B,YAAc,gCAAgC,MAAQ,0BAA0B,QAAU,4BAA4B,UAAY,8BAA8B,SAAW,+B,mBCAzOD,EAAOC,QAAU,CAAC,IAAM,mB,8KCQXC,EAA2B,CACtC,CACEC,GAAI,OACJC,QAAS,YACTC,KAAM,YACNC,SAAU,CACRC,IAAK,kBACLC,KAAM,oBAGV,CACEL,GAAI,QACJC,QAAS,YACTC,KAAM,YACNC,SAAU,CACRC,IAAK,kBACLC,KAAM,oBAGV,CACEL,GAAI,MACJC,QAAS,SACTC,KAAM,QACNC,SAAU,CACRC,IAAK,mBACLC,IAAK,qBAGT,CACEL,GAAI,MACJC,QAAS,UACTC,KAAM,SACNC,SAAU,CACRC,IAAK,kBACLC,IAAK,qBAGT,CACEL,GAAI,QACJC,QAAS,UACTC,KAAM,mBACNC,SAAU,CACRC,IAAK,kBACLC,IAAK,qBAGT,CACEL,GAAI,MACJC,QAAS,WACTC,KAAM,gBACNC,SAAU,CACRC,IAAK,OACLC,IAAK,WAGT,CACEL,GAAI,MACJC,QAAS,UACTC,KAAM,WACNC,SAAU,CACRC,IAAK,UACLC,KAAM,WAGV,CACEL,GAAI,QACJC,QAAS,UACTC,KAAM,cACNC,SAAU,CACRC,IAAK,SACLC,KAAM,WAGV,CACEL,GAAI,OACJC,QAAS,kBACTC,KAAM,cACNC,SAAU,CACRC,IAAK,kBACLC,IAAK,WAGT,CACEL,GAAI,OACJC,QAAS,kBACTC,KAAM,cACNC,SAAU,CACRC,IAAK,kBACLC,IAAK,WAGT,CACEL,GAAI,MACJC,QAAS,UACTC,KAAM,UACNC,SAAU,CACRC,IAAK,SACLC,KAAM,UAGV,CACEL,GAAI,KACJC,QAAS,UACTC,KAAM,SACNC,SAAU,CACRC,IAAK,SACLC,KAAM,WAGV,CACEL,GAAI,MACJC,QAAS,aACTC,KAAM,QACNC,SAAU,CACRC,IAAK,UACLC,IAAK,Y,iCCzHEC,EAAsBC,wBAAmC,MCD/D,SAASC,EACdC,GAEA,OAAO,YACFC,EAAiBD,GAAe,SAACE,EAAGC,GAAJ,OAAUD,EAAEE,YAAcD,EAAEC,cAC/DC,MAAK,SAACH,EAAGC,GAAJ,OAAUD,EAAEE,UAAYD,EAAEC,aAGnC,IAAMH,EAAmB,SAAIK,EAAUC,GAAd,OACvBD,EAAIE,QAAO,SAACC,EAAKC,GAEf,OADKD,EAAIE,MAAK,SAACC,GAAD,OAAOL,EAAGG,EAAGE,OAAKH,EAAII,KAAKH,GAClCD,IACN,KCRE,SAASK,IAId,IAAMC,EAAaC,aAAaC,QAAQ,iBAClCC,EAAeH,EAAaI,KAAKC,MAAML,GAAc,GAF3D,EAI0CM,mBACtCH,GALJ,mBAIOlB,EAJP,KAIsBsB,EAJtB,OAUID,mBAAwB,IAV5B,mBAQEE,EARF,KASEC,EATF,KAWQC,EFfH,WACL,IAAMA,EAAeC,qBAAW7B,GAEhC,IAAK4B,EACH,MAAM,IAAIE,MAAM,2DAGlB,MAAO,CAAEF,gBEQgBG,GAAjBH,aAERI,qBAAU,WACRP,EAAiBvB,EAAmB,GAAD,mBAAKC,GAAL,YAAuBuB,QACzD,CAACA,IAEJM,qBAAU,WAAM,4CACd,gCAAA3B,EAAA,6DACMF,EAAgCkB,EACpCY,QAAQC,IAAI,6BAFd,SAGiCN,EAAaO,sBAH9C,cAGQC,EAHR,OAIEjC,EAAgBD,EAAmB,GAAD,mBAAKC,GAAL,CAAoBiC,KACtDX,EAAiBtB,GALnB,SAOoCyB,EAAaS,mBAPjD,OAOQC,EAPR,OAQEnC,EAAgBD,EAAmB,GAAD,mBAC7BC,GAD6B,YAE7BmC,KAELb,EAAiBtB,GAEjB8B,QAAQC,IAAI,oCACZN,EAAaW,0BACX,IAAIC,KAAKF,EAAoBA,EAAoBG,OAAS,GAAGlC,YAC3D,SAAAmC,GACET,QAAQC,IAAI,kBAAmB,IAAIM,KAAKF,EAAoBA,EAAoBG,OAAS,GAAGlC,YAC5F0B,QAAQC,IAAIQ,GACZf,EAA6Be,MApBrC,6CADc,uBAAC,WAAD,wBA0BdC,KACC,IAEHxB,aAAayB,QAAQ,gBAAiBtB,KAAKuB,UAAU1C,IAErD,IAAMiC,EAAmBjC,EAAcA,EAAcsC,OAAS,GAE9D,MAAO,CAAEtC,gBAAeiC,oBCrDnB,SAASU,EACdC,EACAC,EACAzC,GAEA,IAAM0C,EAuBR,SAAwBD,EAAoBD,GAC1C,IAAMG,EAAmBH,EAAGjD,IAAMkD,EAAGlD,IAC/BqD,EAAoBJ,EAAGhD,IAAMiD,EAAGjD,IAEtC,OAAOqD,KAAKC,MAAMF,EAAmBD,GA3BvBI,CAAeN,EAAID,GAK3BQ,EAQR,SAAwBP,EAAoBD,GAC1C,IAAMzC,EAAIyC,EAAGjD,IAAMkD,EAAGlD,IAChBO,EAAI0C,EAAGhD,IAAMiD,EAAGjD,IAEhByD,EAAWJ,KAAKK,KAAKL,KAAKM,IAAIpD,EAAG,GAAK8C,KAAKM,IAAIrD,EAAG,IAClDsD,EAAmBZ,EAAGxC,UAAYyC,EAAGzC,UAE3C,OAAOiD,EAAWG,EAnBJC,CAAeZ,EAAID,GA6BnC,SAA2BxC,EAAmByC,GAC5C,OAAOzC,EAAYyC,EAAGzC,UA5BLsD,CAAkBtD,EAAWyC,GAO9C,MAAO,CAAElD,IAHGsD,KAAKU,IAAIb,GAASM,EAA6BP,EAAGlD,IAGhDC,IAFFqD,KAAKW,IAAId,GAASM,EAA6BP,EAAGjD,IAE3CQ,aCrBrB,SAASyD,EACPtB,EACAnC,GAEA,GAAyB,IAArBmC,EAAUD,OACZ,OAAOC,EAAU,GAGnB,IAAMuB,EAASb,KAAKc,MAAMxB,EAAUD,OAAS,GAEvC0B,EAAYzB,EAAU0B,MAAM,EAAGH,GAC/BI,EAAY3B,EAAU0B,MAAMH,EAAQvB,EAAUD,QAIpD,OAAIlC,EAFU4D,EAAUA,EAAU1B,OAAS,GAErBlC,UACbyD,EAAaK,EAAW9D,GAExByD,EAAaG,EAAW5D,GAI5B,SAAS+D,EACd5B,EACAnC,GAEA,IAAMgE,EAAUP,EAAatB,EAAWnC,GAExC,OAAOmC,EAAU8B,QAAQD,GAAW,ECX/B,SAASE,EACdC,EACAC,GACC,IAAD,EDWK,SACLjC,EACAnC,GAEA,IAAMqE,EAAQN,EAAmB5B,EAAWnC,GAEtCyC,EAAKN,EAAUkC,GACf7B,EAAKL,EAAUkC,EAAQ,GAE7B,OAAK7B,EAOE,CAAEC,KAAID,MANJ,CACLC,KACAD,GAAIC,GCtBW6B,CAA+BH,EAAMC,EAAKG,WAE7D,MAAO,CAAEC,KAHT,EACQ/B,GAEWgC,MAHnB,EACYjC,I,qDCjBP,SAASkC,EACdC,EACAC,GAEA,IAAM9E,EAAI6E,EAAgBpF,IAAMqF,EAAarF,IACvCQ,EAAI4E,EAAgBnF,IAAMoF,EAAapF,IAI7C,OAFiBqD,KAAKK,KAAKpD,EAAIA,EAAIC,EAAIA,GATf,I,YCCb8E,EAA2D,SAAC,GAGlE,IAFLtF,EAEI,EAFJA,IACAC,EACI,EADJA,IAEMsF,EAAMC,cAOZ,OALAtD,qBAAU,WACR,IAAMuD,EAAOF,EAAIG,UACjBH,EAAII,QAAQ,CAAE3F,MAAKC,OAAOwF,KACzB,CAACzF,EAAKC,IAEF,MCNH2F,G,MAAYC,IAAEC,KAAK,CACvBC,QAASC,wBACTC,SAAU,CAAC,GAAI,IACfC,WAAY,CAAC,GAAI,OAGbC,EAAkBN,IAAEC,KAAK,CAC7BC,QAASC,2BACTC,SAAU,CAAC,GAAI,IACfC,WAAY,CAAC,GAAI,MASNE,EAA8B,SAAC,GAAD,IACzChB,EADyC,EACzCA,gBACAiB,EAFyC,EAEzCA,iBACAC,EAHyC,EAGzCA,UAHyC,OAKzC,eAACC,EAAA,EAAD,CAAcC,OAAQpB,EAAiBK,KAAM,EAA7C,UACE,cAACgB,EAAA,EAAD,CACEC,YAAY,yEACZC,IAAI,uDAEN,cAACC,EAAA,EAAD,CAAQ7G,SAAUqF,EAAiBU,KAAMF,IACxCS,IAAqBlB,EAAeC,EAAiBiB,GACpD,cAACO,EAAA,EAAD,CAAQ7G,SAAUsG,EAAkBP,KAAMK,IACxC,KACJ,cAAC,EAAD,CACEnG,IAAKoF,EAAgBpF,IACrBC,IAAKmF,EAAgBnF,MAEvB,cAAC4G,EAAA,EAAD,CAAUP,UAAWA,EAAUQ,OAAO1B,S,iBCvCpC2B,EAAiB,cAGjBC,EAAQ,SAACC,GAAD,OAAgB,IAAIC,SAAQ,SAACC,GAAD,OAAOC,WAAWD,EAAGF,OAExD,SAASI,EAAWC,GAQzB,IAAMC,EAAiB7E,KAAK8E,MAD3B,EAEiC9F,oBAAS,GAF1C,mBAEM+F,EAFN,KAEiBC,EAFjB,KAID,OACE,sBAAKC,UAAWC,IAAOC,WAAvB,UACE,sBAAKF,UAAWC,IAAOE,YAAvB,UACE,oBAAGH,UAAWC,IAAOG,MAArB,UACG,IAAIrF,KAAK4E,EAAMlC,gBAAgB3E,WAAWuH,iBACL,MAArCV,EAAMlC,gBAAgB6C,YAAtB,aACSX,EAAMlC,gBAAgB6C,YAD/B,SAEG,KACH,MACAX,EAAMY,SAAN,UACMZ,EAAMY,SAASpI,KADrB,aAC8BwH,EAAMY,SAASrI,QAD7C,KAEG,QAEN,uBACEsI,KAAK,QACLC,IAAKrB,EACLsB,IAAKd,EACLe,MAAOhB,EAAMlC,gBAAgB3E,UAC7B8H,SAAU,SAACC,GACT,IAAM/H,EAAYgI,SAASD,EAAEE,OAAOJ,OACpChB,EAAMiB,SAAS9H,MAGnB,sBACEkI,MAAO,CAAEC,QAAS,OAAQC,WAAY,SAAUC,IAAK,IACrDC,QAAO,sBAAE,4BAAAxI,EAAA,0DACHkH,EADG,iDAKPC,GAAa,GAGPsB,EAAIjC,EARH,YASLiC,EAAIzB,GATC,iCAYCP,EAAM,KAZP,OAaL7E,QAAQC,IAAI,aAAcqF,GAE1BH,EAAMiB,SAASS,GAfV,OAULA,GAlDS,KAwCJ,uBAkBPtB,GAAa,GAlBN,4CAFX,UAuBE,kDACA,oBAAGC,UAAWC,IAAOqB,UAArB,4BACkB3B,EAAM4B,YADxB,iBAIF,0BACEZ,OAAO,IAAI5F,MAAOsC,UAAYsC,EAAM6B,eAAenE,UACnDqD,IAAKf,EAAM8B,aAAapE,UAAYsC,EAAM6B,eAAenE,UACzD2C,UAAWC,IAAOyB,cAGtB,qBAAK1B,UAAWC,IAAO0B,aC/D7B,IAAMC,EAAqB,IAAI7G,KAAK,KAAM,EAAG,IACvC8G,EAAuB,IAAI9G,KAAK,KAAM,GAAI,GAAI,GAAI,EAAG,GACrD+G,EAAgBC,YAAiBH,EAAoB,IAAI7G,MAgEhDiH,MA9Df,WAAgB,IAAD,EAC+BxI,IAApCd,EADK,EACLA,cAAeiC,EADV,EACUA,iBADV,EAEyCZ,mBACpDY,GAHW,mBAENsH,EAFM,KAEeC,EAFf,KAUb,GAJA3H,qBAAU,WACR2H,EAAuBvH,KACtB,CAACA,KAECsH,EACH,OACE,8BACE,8CAKN,IL9BAhF,EACAC,EKiCMiF,EL5BD,SAAmClF,GACxC,OAAOA,EAAKW,KAAI,SAACwE,GAAD,OAAOA,EAAEhK,YK2BCiK,ELlC1BpF,EK+BEvE,EL9BFwE,EK+BE,IAAInC,KAAKkH,EAAoBnJ,WL7BxBmE,EAAKqF,QAAO,SAACzB,GAAD,OAAOA,EAAE/H,WAAaoE,EAAKG,eKiCxCkD,EAAWvI,EAAauK,MAC5B,SAACC,GAAD,OAAUA,EAAKvK,KAAOgK,EAAoBQ,iBAK5C,OAFAjI,QAAQC,IAAI,YAAawH,GAGvB,sBAAKjC,UAAWC,IAAOrC,IAAvB,UACE,cAAC,EAAD,CACEH,gBAAiBwE,EAAoB7J,SACrCsG,iBAAgB,OAAE6B,QAAF,IAAEA,OAAF,EAAEA,EAAUnI,SAC5BuG,UAAWwD,IAEb,cAACzC,EAAD,CACEjC,gBAAiBwE,EACjB1B,SAAUA,EACVK,SAAU,SAAC9H,GACT,IAAM4J,EAAS1F,EACbtE,EACA,IAAIqC,KAAKjC,IAGL6J,ECvDT,SACL1F,EACA2F,EACAC,GAEA,IAAMC,EAASzH,EACb,CACEhD,IAAK4E,EAAK7E,SAASC,IACnBC,IAAK2E,EAAK7E,SAASE,IACnBQ,UAAWmE,EAAKnE,WAElB,CACET,IAAKuK,EAAMxK,SAASC,IACpBC,IAAKsK,EAAMxK,SAASE,IACpBQ,UAAW8J,EAAM9J,WAEnB+J,EAAKxF,WAGP,MAAO,CACLvE,UAAW+J,EAAKxF,UAChBjF,SAAU,CACRC,IAAKyK,EAAOzK,IACZC,IAAKwK,EAAOxK,KAEdgI,YAAarD,EAAKqD,YAClBmC,cAAexF,EAAKwF,eD6BGM,CACfL,EAAOpF,KACPoF,EAAOnF,MACP,IAAIxC,KAAKjC,IAGXoJ,EAAuBS,IAEzBpB,YAAaO,EACbN,eAAgBK,EAChBJ,aAAcG,QE7DPoB,EAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,6BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,O,gBCUP,SAASQ,EAAiBC,GAK/B,OAJ8BC,OAAOC,OACnCF,GAG0B9F,KAAI,kBAAG8F,EAAH,EAAGA,KAAH,MAAe,CAC7CtL,SAAU,CACRC,IAAKqL,EAAKrL,IACVC,IAAKoL,EAAKG,KAEZpB,cAAa,UAAEiB,EAAKI,mBAAP,aAAE,EAAkB7L,GACjCa,UAA0B,IAAf4K,EAAKK,QAChBzD,YAAaoD,EAAKM,iBAAmB,M,YC5BzCxJ,QAAQC,IAAI,iBACZwJ,IAAUC,cCJoB,CAC5BC,OAAQ,0CACRC,WAAY,+BACZC,YACE,sEACFC,UAAW,eACXC,cAAe,2BACfC,kBAAmB,eACnBC,MAAO,4CACPC,cAAe,iBDJjBT,IAAUU,YACVnK,QAAQC,IAAI,SAEL,IAAMmK,EAAWX,IEAlB9J,EAAe,ICHrB,WAGE,aAAe,yBAFP0K,yBAEM,EACZ,IAAMC,EAAKF,EAASG,YACpBC,KAAKH,oBAAsBC,EAAGG,WAAW,aAL7C,sMASgCD,KAAKH,oBAC9BK,QAAQ,YAAa,QACrBC,MAAM,GACNC,MAZP,cASUC,EATV,OAcU3B,EAAO2B,EAAcC,KAAK1H,KAAI,SAAC2H,GAAD,OAAQA,EAAG7B,UAEzC8B,EAAiB/B,EAAiBC,GAhB5C,kBAkBW8B,EAAe,IAlB1B,+QAsBuB,iCAtBvB,cAsBU9B,EAtBV,yBAwBWD,EAAiBC,EAAK+B,UAxBjC,iJA4BIC,EACAC,GAEAX,KAAKH,oBACFK,QAAQ,aACRU,MAAM,YAAa,IAAKF,EAAUrI,WAClCwI,YAAW,SAAClD,GACX,IAAM6C,EAAiB/B,EACrBd,EAAS2C,KAAK1H,KAAI,SAAC2H,GAAD,OAAQA,EAAG7B,WAG/BiC,EAASH,UAvCjB,MDKAM,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAACzN,EAAoB0N,SAArB,CAA8BtF,MAAOxG,EAArC,SACE,cAAC,EAAD,QAGJ+L,SAASC,eAAe,SAM1BnD,M","file":"static/js/main.dcbe4816.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"bottomMenu\":\"BottomMenu_bottomMenu__2um7V\",\"menuContent\":\"BottomMenu_menuContent__2Eu4V\",\"dates\":\"BottomMenu_dates__2j0Oo\",\"overlay\":\"BottomMenu_overlay__2suuz\",\"countDown\":\"BottomMenu_countDown__2mHIt\",\"progress\":\"BottomMenu_progress__x8ktt\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"map\":\"App_map__3ouXs\"};","import { LatLngLiteral } from \"leaflet\";\n\nexport type PortInfo = {\n  id: string;\n  position: LatLngLiteral;\n  country: string;\n  city: string;\n};\n\nexport const portsMapInfo: PortInfo[] = [\n  {\n    id: \"3302\",\n    country: \"España\",\n    city: \"Algeciras\",\n    position: {\n      lat: 36.17549129756906,\n      lng: -5.418971717099447,\n    },\n  },\n  {\n    id: \"21826\",\n    country: \"España\",\n    city: \"Algeciras\",\n    position: {\n      lat: 36.17549129756906,\n      lng: -5.418971717099447,\n    },\n  },\n  {\n    id: \"343\",\n    country: \"Suecia\",\n    city: \"Malmo\",\n    position: {\n      lat: 55.617983507540984,\n      lng: 13.001871231147542,\n    },\n  },\n  {\n    id: \"233\",\n    country: \"Polonia\",\n    city: \"Gdynia\",\n    position: {\n      lat: 54.54480274086806,\n      lng: 18.509637289041667,\n    },\n  },\n  {\n    id: \"22450\",\n    country: \"Polonia\",\n    city: \"Puerto de Gdynia\",\n    position: {\n      lat: 54.54480274086806,\n      lng: 18.509637289041667,\n    },\n  },\n  {\n    id: \"771\",\n    country: \"Lituania\",\n    city: \"Klaipėda\",\n    position: {\n      lat: 55.714,\n      lng: 21.11567,\n    },\n  },\n  {\n    id: \"251\",\n    country: \"Irlanda\",\n    city: \"Greenore\",\n    position: {\n      lat: 54.034677,\n      lng: -6.133334,\n    },\n  },\n  {\n    id: \"21652\",\n    country: \"Irlanda\",\n    city: \"Ringaskiddy\",\n    position: {\n      lat: 51.83541,\n      lng: -8.330348,\n    },\n  },\n  {\n    id: \"2036\",\n    country: \"Países Bajos\",\n    city: \"Róterdam\",\n    position: {\n      lat: 51.90404732155975,\n      lng: 4.356333,\n    },\n  },\n  {\n    id: \"2104\",\n    country: \"Países Bajos\",\n    city: \"Vlaardingen\",\n    position: {\n      lat: 51.90404732155975,\n      lng: 4.356333,\n    },\n  },\n  {\n    id: \"502\",\n    country: \"Francia\",\n    city: \"Lorient\",\n    position: {\n      lat: 47.734040,\n      lng: -3.362030,\n    },\n  },\n  {\n    id: \"89\",\n    country: \"Francia\",\n    city: \"Nantes\",\n    position: {\n      lat: 47.213910,\n      lng: -1.541655,\n    },\n  },\n  {\n    id: \"122\",\n    country: \"Bélgica\",\n    city: \"Ghent\",\n    position: {\n      lat: 51.119525,\n      lng: 3.766277,\n    },\n  },\n];\n","import { createContext, useContext } from \"react\";\nimport { Repositories } from \"../repositories/Repositories\";\n\nexport const RepositoriesContext = createContext<Repositories | null>(null);\n\nexport function useRepositories() {\n  const repositories = useContext(RepositoriesContext);\n\n  if (!repositories) {\n    throw new Error(\"useRepositories must be used within RepositoriesContext\");\n  }\n\n  return { repositories };\n}\n","import { TimeSnapshots } from \"../models/TimeSnapshots\";\n\nexport function cleanTimeSnapshots(\n  timeSnapshots: TimeSnapshots\n): TimeSnapshots {\n  return [\n    ...uniqueElementsBy(timeSnapshots, (a, b) => a.timestamp === b.timestamp),\n  ].sort((a, b) => a.timestamp - b.timestamp);\n}\n\nconst uniqueElementsBy = <T>(arr: T[], fn: (a: T, b: T) => boolean) =>\n  arr.reduce((acc, v) => {\n    if (!acc.some((x) => fn(v, x))) acc.push(v);\n    return acc;\n  }, [] as T[]);\n","import { useEffect, useState } from \"react\";\nimport { useRepositories } from \"./useRepositories\";\nimport { TimeSnapshot } from \"../models/TimeSnapshot\";\nimport { TimeSnapshots } from \"../models/TimeSnapshots\";\nimport { cleanTimeSnapshots } from \"../utils/cleanTimeSnapshot\";\n\nexport function useTimeSnapshots(): {\n  timeSnapshots: TimeSnapshots;\n  lastTimeSnapshot: TimeSnapshot | null;\n} {\n  const localCache = localStorage.getItem(\"timeSnapshots\");\n  const defaultValue = localCache ? JSON.parse(localCache) : [];\n\n  const [timeSnapshots, setTimeSnapshots] = useState<TimeSnapshots>(\n      defaultValue\n  );\n  const [\n    timeSnapshotsFromListener,\n    setTimeSnapshotsFromListener,\n  ] = useState<TimeSnapshots>([]);\n  const { repositories } = useRepositories();\n\n  useEffect(() => {\n    setTimeSnapshots(cleanTimeSnapshots([...timeSnapshots, ...timeSnapshotsFromListener]));\n  }, [timeSnapshotsFromListener]);\n\n  useEffect(() => {\n    async function effect() {\n      let timeSnapshots: TimeSnapshot[] = defaultValue;\n      console.log(\"asking getLastTimeSnapsho\");\n      const lastTimeSnapshot = await repositories.getLastTimeSnapshot();\n      timeSnapshots = cleanTimeSnapshots([...timeSnapshots, lastTimeSnapshot]);\n      setTimeSnapshots(timeSnapshots);\n\n      const cachedTimeSnapshots = await repositories.getTimeSnapshots();\n      timeSnapshots = cleanTimeSnapshots([\n        ...timeSnapshots,\n        ...cachedTimeSnapshots,\n      ]);\n      setTimeSnapshots(timeSnapshots);\n\n      console.log(\"asking subscribeToNewerLocations\");\n      repositories.subscribeToNewerLocations(\n        new Date(cachedTimeSnapshots[cachedTimeSnapshots.length - 1].timestamp),\n          locations => {\n            console.log(\"Locations after\", new Date(cachedTimeSnapshots[cachedTimeSnapshots.length - 1].timestamp))\n            console.log(locations)\n            setTimeSnapshotsFromListener(locations)\n          }\n      );\n    }\n\n    effect();\n  }, []);\n\n  localStorage.setItem(\"timeSnapshots\", JSON.stringify(timeSnapshots));\n\n  const lastTimeSnapshot = timeSnapshots[timeSnapshots.length - 1];\n\n  return { timeSnapshots, lastTimeSnapshot };\n}\n","export type PositionAtTime = {\n  lat: number;\n  lng: number;\n  timestamp: number;\n};\n\nexport function estimateCoordinatesAtTime(\n  p2: PositionAtTime,\n  p1: PositionAtTime,\n  timestamp: number\n): PositionAtTime {\n  const angle = calculateAngle(p1, p2);\n  const speed = calculateSpeed(p1, p2);\n\n  const duration = calculateDuration(timestamp, p1);\n\n  const distanceTraveledEstimation = speed * duration;\n\n  const lat = Math.cos(angle) * distanceTraveledEstimation + p1.lat;\n  const lng = Math.sin(angle) * distanceTraveledEstimation + p1.lng;\n\n  return { lat, lng, timestamp };\n}\n\nfunction calculateSpeed(p1: PositionAtTime, p2: PositionAtTime) {\n  const b = p2.lat - p1.lat;\n  const a = p2.lng - p1.lng;\n\n  const distance = Math.sqrt(Math.pow(b, 2) + Math.pow(a, 2));\n  const timeTookDistance = p2.timestamp - p1.timestamp;\n\n  return distance / timeTookDistance;\n}\n\nfunction calculateAngle(p1: PositionAtTime, p2: PositionAtTime) {\n  const distanceLatitude = p2.lat - p1.lat;\n  const distanceLongitude = p2.lng - p1.lng;\n\n  return Math.atan2(distanceLongitude, distanceLatitude);\n}\n\nfunction calculateDuration(timestamp: number, p1: PositionAtTime) {\n  return timestamp - p1.timestamp;\n}\n","function binarySearch<T extends { timestamp: number }>(\n  locations: T[],\n  timestamp: number\n): T {\n  if (locations.length === 1) {\n    return locations[0];\n  }\n\n  const middle = Math.floor(locations.length / 2);\n\n  const lowerPart = locations.slice(0, middle);\n  const upperPart = locations.slice(middle, locations.length);\n\n  const pivot = lowerPart[lowerPart.length - 1];\n\n  if (timestamp > pivot.timestamp) {\n    return binarySearch(upperPart, timestamp);\n  } else {\n    return binarySearch(lowerPart, timestamp);\n  }\n}\n\nexport function findIndexNearestTo<T extends { timestamp: number }>(\n  locations: T[],\n  timestamp: number\n) {\n  const element = binarySearch(locations, timestamp);\n\n  return locations.indexOf(element) - 1;\n}\n\nexport function findBoundingPointsForTimestamp<T extends { timestamp: number }>(\n  locations: T[],\n  timestamp: number\n) {\n  const index = findIndexNearestTo(locations, timestamp);\n\n  const p1 = locations[index];\n  const p2 = locations[index + 1];\n\n  if (!p2) {\n    return {\n      p1,\n      p2: p1,\n    };\n  }\n\n  return { p1, p2 };\n}\n","import { TimeSnapshot } from \"./TimeSnapshot\";\nimport { Positions } from \"./Positions\";\nimport { findBoundingPointsForTimestamp } from \"../utils/findIndexNearestTo\";\n\nexport type TimeSnapshots = TimeSnapshot[];\n\nexport function timeSnapshotsBefore(\n  self: TimeSnapshots,\n  date: Date\n): TimeSnapshots {\n  return self.filter((e) => e.timestamp <= date.getTime());\n}\n\nexport function timeSnapshotsGetPositions(self: TimeSnapshots): Positions {\n  return self.map((s) => s.position);\n}\n\nexport function timeSnapshotsFindBoundingSnapshotsForTimestamp(\n  self: TimeSnapshots,\n  date: Date\n) {\n  const { p1, p2 } = findBoundingPointsForTimestamp(self, date.getTime());\n\n  return { left: p1, right: p2 };\n}\n","import { LatLngLiteral } from \"leaflet\";\n\nconst VERY_NEAR_EPSILON = 0.02;\n\nexport function portIsTooClose(\n  currentPosition: LatLngLiteral,\n  portPosition: LatLngLiteral\n) {\n  const a = currentPosition.lat - portPosition.lat;\n  const b = currentPosition.lng - portPosition.lng;\n\n  const distance = Math.sqrt(a * a + b * b);\n\n  return distance < VERY_NEAR_EPSILON;\n}\n","import { FC, useEffect } from \"react\";\nimport { useMap } from \"react-leaflet\";\n\nexport const CenterOnLocationChange: FC<{ lat: number; lng: number }> = ({\n  lat,\n  lng,\n}) => {\n  const map = useMap();\n\n  useEffect(() => {\n    const zoom = map.getZoom();\n    map.setView({ lat, lng }, zoom);\n  }, [lat, lng]);\n\n  return null;\n};\n","import React, { FC } from \"react\";\nimport L from \"leaflet\";\nimport { MapContainer, Marker, Polyline, TileLayer } from \"react-leaflet\";\nimport { Position } from \"../models/MyPosition\";\nimport { portIsTooClose } from \"../utils/portIsTooClose\";\nimport { CenterOnLocationChange } from \"./CenterOnLocationChange\";\nimport \"./PatriMap.module.css\";\n\nconst PatriIcon = L.icon({\n  iconUrl: process.env.PUBLIC_URL + \"/patri.png\",\n  iconSize: [40, 40],\n  iconAnchor: [20, 20],\n});\n\nconst DestinationIcon = L.icon({\n  iconUrl: process.env.PUBLIC_URL + \"/tracking.png\",\n  iconSize: [32, 32],\n  iconAnchor: [16, 16],\n});\n\ntype PatriMapProps = {\n  currentPosition: Position;\n  nextPortPosition?: Position;\n  positions: Position[];\n};\n\nexport const PatriMap: FC<PatriMapProps> = ({\n  currentPosition,\n  nextPortPosition,\n  positions,\n}) => (\n  <MapContainer center={currentPosition} zoom={8}>\n    <TileLayer\n      attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n      url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n    />\n    <Marker position={currentPosition} icon={PatriIcon} />\n    {nextPortPosition && !portIsTooClose(currentPosition, nextPortPosition) ? (\n      <Marker position={nextPortPosition} icon={DestinationIcon} />\n    ) : null}\n    <CenterOnLocationChange\n      lat={currentPosition.lat}\n      lng={currentPosition.lng}\n    />\n    <Polyline positions={positions.concat(currentPosition)} />\n  </MapContainer>\n);\n","import { TimeSnapshot } from \"../models/TimeSnapshot\";\nimport { PortInfo } from \"../utils/portsMapInfo\";\nimport styles from \"./BottomMenu.module.css\";\nimport React, { useState } from \"react\";\n\nconst MIN_TIME_RANGE = 1608802672283;\nconst HOUR_IN_MILLIS = 1000 * 60 * 60;\n\nconst sleep = (ms: number) => new Promise((r) => setTimeout(r, ms));\n\nexport function BottomMenu(props: {\n  currentPosition: TimeSnapshot;\n  nextPort?: PortInfo;\n  onChange: (e: number) => void;\n  daysToPatri: number;\n  patriDeparture: Date;\n  patriArrival: Date;\n}) {\n  const MAX_TIME_RANGE = Date.now();\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  return (\n    <div className={styles.bottomMenu}>\n      <div className={styles.menuContent}>\n        <p className={styles.dates}>\n          {new Date(props.currentPosition.timestamp).toLocaleString()}\n          {props.currentPosition.temperature != null\n            ? ` | ${props.currentPosition.temperature}ºC`\n            : null}\n          {\" | \"}\n          {props.nextPort\n            ? `${props.nextPort.city} (${props.nextPort.country})`\n            : null}\n        </p>\n        <input\n          type=\"range\"\n          min={MIN_TIME_RANGE}\n          max={MAX_TIME_RANGE}\n          value={props.currentPosition.timestamp}\n          onChange={(e) => {\n            const timestamp = parseInt(e.target.value);\n            props.onChange(timestamp);\n          }}\n        />\n        <div\n          style={{ display: \"flex\", alignItems: \"center\", gap: 10 }}\n          onClick={async () => {\n            if (isPlaying) {\n              return;\n            }\n\n            setIsPlaying(true);\n\n            for (\n              let i = MIN_TIME_RANGE;\n              i < MAX_TIME_RANGE;\n              i += HOUR_IN_MILLIS\n            ) {\n              await sleep(100);\n              console.log(\"Is playing\", isPlaying);\n\n              props.onChange(i);\n            }\n\n            setIsPlaying(false);\n          }}\n        >\n          <button>Ver el viaje</button>\n          <p className={styles.countDown}>\n            Patri llega en {props.daysToPatri} días\n          </p>\n        </div>\n        <progress\n          value={new Date().getTime() - props.patriDeparture.getTime()}\n          max={props.patriArrival.getTime() - props.patriDeparture.getTime()}\n          className={styles.progress}\n        />\n      </div>\n      <div className={styles.overlay} />\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport styles from \"./App.module.css\";\nimport \"leaflet/dist/leaflet.css\";\nimport differenceInDays from \"date-fns/differenceInDays\";\nimport { portsMapInfo } from \"./utils/portsMapInfo\";\nimport { useTimeSnapshots } from \"./hooks/useTimeSnapshots\";\nimport { timeSnapshotEstimateAtTime } from \"./models/TimeSnapshot\";\nimport {\n  timeSnapshotsBefore,\n  timeSnapshotsFindBoundingSnapshotsForTimestamp,\n  timeSnapshotsGetPositions,\n} from \"./models/TimeSnapshots\";\nimport { PatriMap } from \"./components/PatriMap\";\nimport { BottomMenu } from \"./components/BottomMenu\";\n\nconst PATRI_ARRIVAL_DATE = new Date(2021, 3, 10);\nconst PATRI_DEPARTURE_DATE = new Date(2020, 11, 22, 22, 0, 0);\nconst DATS_TO_PATRI = differenceInDays(PATRI_ARRIVAL_DATE, new Date());\n\nfunction App() {\n  const { timeSnapshots, lastTimeSnapshot } = useTimeSnapshots();\n  const [currentTimeSnapshot, setCurrentTimeSnapshot] = useState(\n    lastTimeSnapshot\n  );\n\n  useEffect(() => {\n    setCurrentTimeSnapshot(lastTimeSnapshot);\n  }, [lastTimeSnapshot]);\n\n  if (!currentTimeSnapshot) {\n    return (\n      <div>\n        <p>Cargando...</p>\n      </div>\n    );\n  }\n\n  const filteredTimeSnapshots = timeSnapshotsBefore(\n    timeSnapshots,\n    new Date(currentTimeSnapshot.timestamp)\n  );\n  const polyLinePositions = timeSnapshotsGetPositions(filteredTimeSnapshots);\n\n  const nextPort = portsMapInfo.find(\n    (port) => port.id === currentTimeSnapshot.arrivalPortId\n  );\n\n  console.log(\"NEXT PORT\", currentTimeSnapshot)\n\n  return (\n    <div className={styles.map}>\n      <PatriMap\n        currentPosition={currentTimeSnapshot.position}\n        nextPortPosition={nextPort?.position}\n        positions={polyLinePositions}\n      />\n      <BottomMenu\n        currentPosition={currentTimeSnapshot}\n        nextPort={nextPort}\n        onChange={(timestamp) => {\n          const bounds = timeSnapshotsFindBoundingSnapshotsForTimestamp(\n            timeSnapshots,\n            new Date(timestamp)\n          );\n\n          const snapshot = timeSnapshotEstimateAtTime(\n            bounds.left,\n            bounds.right,\n            new Date(timestamp)\n          );\n\n          setCurrentTimeSnapshot(snapshot);\n        }}\n        daysToPatri={DATS_TO_PATRI}\n        patriDeparture={PATRI_DEPARTURE_DATE}\n        patriArrival={PATRI_ARRIVAL_DATE}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import { Position } from \"./MyPosition\";\nimport { estimateCoordinatesAtTime } from \"../utils/estimateCoordinatesAtTime\";\n\nexport type TimeSnapshot = {\n  timestamp: number;\n  temperature: number;\n  position: Position;\n  arrivalPortId?: string;\n};\n\nexport function timeSnapshotEstimateAtTime(\n  self: TimeSnapshot,\n  other: TimeSnapshot,\n  time: Date\n): TimeSnapshot {\n  const coords = estimateCoordinatesAtTime(\n    {\n      lat: self.position.lat,\n      lng: self.position.lng,\n      timestamp: self.timestamp,\n    },\n    {\n      lat: other.position.lat,\n      lng: other.position.lng,\n      timestamp: other.timestamp,\n    },\n    time.getTime()\n  );\n\n  return {\n    timestamp: time.getTime(),\n    position: {\n      lat: coords.lat,\n      lng: coords.lng,\n    },\n    temperature: self.temperature,\n    arrivalPortId: self.arrivalPortId,\n  };\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import { VesselLocationNode } from \"../firebase/typings\";\nimport { TimeSnapshot } from \"../models/TimeSnapshot\";\n\nexport function mapFirebaseData(data: any) {\n  const rawFirebaseLocations = (Object.values(\n    data\n  ) as any) as VesselLocationNode[];\n\n  return rawFirebaseLocations\n    .map(({ data }) => ({\n      timestamp: data.lastPos * 1000,\n      lat: data.lat,\n      lng: data.lon,\n      temperature: data.windTemperature,\n      arrivalPort: data.arrivalPort,\n    }))\n    .slice(10, rawFirebaseLocations.length);\n}\n\nexport function mapFirebaseData2(data: any): TimeSnapshot[] {\n  const rawFirebaseLocations = (Object.values(\n    data\n  ) as any) as VesselLocationNode[];\n\n  return rawFirebaseLocations.map(({ data }) => ({\n    position: {\n      lat: data.lat,\n      lng: data.lon,\n    },\n    arrivalPortId: data.arrivalPort?.id,\n    timestamp: data.lastPos * 1000,\n    temperature: data.windTemperature || 0,\n  }));\n}\n","import firebase1 from \"firebase\";\nimport { firebaseConfig } from \"../config/firebase\";\n\nconsole.log(\"Inicializando\");\nfirebase1.initializeApp(firebaseConfig);\nfirebase1.analytics();\nconsole.log(\"Listo\");\n\nexport const firebase = firebase1;\nexport type FirebaseCollection = firebase1.firestore.CollectionReference<firebase1.firestore.DocumentData>;\n","export const firebaseConfig = {\n  apiKey: \"AIzaSyBThWjVqdQVhkOm-P4VwtOkK1XvoQBFjBs\",\n  authDomain: \"patri-chaser.firebaseapp.com\",\n  databaseURL:\n    \"https://patri-chaser-default-rtdb.europe-west1.firebasedatabase.app\",\n  projectId: \"patri-chaser\",\n  storageBucket: \"patri-chaser.appspot.com\",\n  messagingSenderId: \"191999461469\",\n  appId: \"1:191999461469:web:d17e4c14ed1ea2f1e0a5b4\",\n  measurementId: \"G-YL17SVHMQY\",\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { RepositoriesContext } from \"./hooks/useRepositories\";\nimport { RepositoriesImpl } from \"./repositories/RepositoriesImpl\";\n\nconst repositories = new RepositoriesImpl();\n\nReactDOM.render(\n  <React.StrictMode>\n    <RepositoriesContext.Provider value={repositories}>\n      <App />\n    </RepositoriesContext.Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { mapFirebaseData2 } from \"../utils/mapFirebaseData\";\nimport { Repositories } from \"./Repositories\";\nimport { firebase, FirebaseCollection } from \"../firebase/firebase\";\nimport { TimeSnapshot } from \"../models/TimeSnapshot\";\n\nexport class RepositoriesImpl implements Repositories {\n  private locationsCollection: FirebaseCollection;\n\n  constructor() {\n    const db = firebase.firestore();\n    this.locationsCollection = db.collection(\"locations\");\n  }\n\n  async getLastTimeSnapshot(): Promise<TimeSnapshot> {\n    const querySnapshot = await this.locationsCollection\n      .orderBy(\"timestamp\", \"desc\")\n      .limit(1)\n      .get();\n\n    const data = querySnapshot.docs.map((el) => el.data());\n\n    const newerLocations = mapFirebaseData2(data);\n\n    return newerLocations[0];\n  }\n\n  async getTimeSnapshots(): Promise<TimeSnapshot[]> {\n    const data = await import(\"./time-snapshot-cache.json\");\n\n    return mapFirebaseData2(data.default);\n  }\n\n  subscribeToNewerLocations(\n    afterDate: Date,\n    callback: (locations: TimeSnapshot[]) => void\n  ): void {\n    this.locationsCollection\n      .orderBy(\"timestamp\")\n      .where(\"timestamp\", \">\", afterDate.getTime())\n      .onSnapshot((snapshot) => {\n        const newerLocations = mapFirebaseData2(\n          snapshot.docs.map((el) => el.data())\n        );\n\n        callback(newerLocations);\n      });\n  }\n}\n"],"sourceRoot":""}