(this.webpackJsonppatripatri=this.webpackJsonppatripatri||[]).push([[0],{16:function(t,e,n){t.exports={bottomMenu:"BottomMenu_bottomMenu__2KZEQ",menuContent:"BottomMenu_menuContent__1dDXV",dates:"BottomMenu_dates__3kBXF",overlay:"BottomMenu_overlay__2ATTf",countDown:"BottomMenu_countDown__LY052",progress:"BottomMenu_progress__1iv3f"}},28:function(t,e,n){t.exports={map:"App_map__3Febj"}},39:function(t,e,n){},41:function(t,e,n){},46:function(t,e,n){"use strict";n.r(e);var a=n(4),r=n(3),i=n.n(r),o=n(21),s=n.n(o),c=(n(39),n(10)),u=n(28),l=n.n(u),p=(n(40),n(31)),m=[{id:"3302",country:"Espa\xf1a",city:"Algeciras",position:{lat:36.17549129756906,lng:-5.418971717099447}},{id:"21826",country:"Espa\xf1a",city:"Algeciras",position:{lat:36.17549129756906,lng:-5.418971717099447}},{id:"343",country:"Suecia",city:"Malmo",position:{lat:55.617983507540984,lng:13.001871231147542}},{id:"233",country:"Polonia",city:"Gdynia",position:{lat:54.54480274086806,lng:18.509637289041667}},{id:"22450",country:"Polonia",city:"Puerto de Gdynia",position:{lat:54.54480274086806,lng:18.509637289041667}},{id:"771",country:"Lituania",city:"Klaip\u0117da",position:{lat:55.714,lng:21.11567}},{id:"251",country:"Irlanda",city:"Greenore",position:{lat:54.034677,lng:-6.133334}},{id:"21652",country:"Irlanda",city:"Ringaskiddy",position:{lat:51.83541,lng:-8.330348}},{id:"2036",country:"Pa\xedses Bajos",city:"R\xf3terdam",position:{lat:51.943305,lng:4.141812}}],f=n(26),d=Object(r.createContext)(null);function g(){var t=Object(r.useState)([]),e=Object(c.a)(t,2),n=e[0],a=e[1],i=Object(r.useState)([]),o=Object(c.a)(i,2),s=o[0],u=o[1],l=function(){var t=Object(r.useContext)(d);if(!t)throw new Error("useRepositories must be used within RepositoriesContext");return{repositories:t}}().repositories;Object(r.useEffect)((function(){var t=n[n.length-1],e=s.filter((function(e){return e.timestamp>t.timestamp}));console.log({newer:e}),a([].concat(Object(f.a)(n),Object(f.a)(e)))}),[s]),Object(r.useEffect)((function(){Promise.resolve().then((function(){return l.getLastTimeSnapshot()})).then((function(t){a([t])})).then((function(){return l.getTimeSnapshots()})).then((function(t){return a(t),new Date(t[t.length-1].timestamp)})).then((function(t){l.subscribeToNewerLocations(t,u)}))}),[]);var p=n[n.length-1];return{timeSnapshots:n,lastTimeSnapshot:p}}function h(t,e,n){var a=function(t,e){var n=e.lat-t.lat,a=e.lng-t.lng;return Math.atan2(a,n)}(e,t),r=function(t,e){var n=e.lat-t.lat,a=e.lng-t.lng,r=Math.sqrt(Math.pow(n,2)+Math.pow(a,2)),i=e.timestamp-t.timestamp;return r/i}(e,t)*function(t,e){return t-e.timestamp}(n,e);return{lat:Math.cos(a)*r+e.lat,lng:Math.sin(a)*r+e.lng,timestamp:n}}function b(t,e){if(1===t.length)return t[0];var n=Math.floor(t.length/2),a=t.slice(0,n),r=t.slice(n,t.length);return e>a[a.length-1].timestamp?b(r,e):b(a,e)}function j(t,e){var n=b(t,e);return t.indexOf(n)-1}function v(t,e){var n=function(t,e){var n=j(t,e),a=t[n],r=t[n+1];return r?{p1:a,p2:r}:{p1:a,p2:a}}(t,e.getTime());return{left:n.p1,right:n.p2}}var O=n(11),x=n.n(O),y=n(48),w=n(51),P=n(49),T=n(50);function S(t,e){var n=t.lat-e.lat,a=t.lng-e.lng;return Math.sqrt(n*n+a*a)<.02}var M=n(47),_=function(t){var e=t.lat,n=t.lng,a=Object(M.a)();return Object(r.useEffect)((function(){var t=a.getZoom();a.setView({lat:e,lng:n},t)}),[e,n]),null},C=(n(41),x.a.icon({iconUrl:"/patripatri/patri.png",iconSize:[40,40],iconAnchor:[20,20]})),D=x.a.icon({iconUrl:"/patripatri/tracking.png",iconSize:[32,32],iconAnchor:[16,16]}),k=function(t){var e=t.currentPosition,n=t.nextPortPosition,r=t.positions;return Object(a.jsxs)(y.a,{center:e,zoom:8,children:[Object(a.jsx)(w.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(a.jsx)(P.a,{position:e,icon:C}),n&&!S(e,n)?Object(a.jsx)(P.a,{position:n,icon:D}):null,Object(a.jsx)(_,{lat:e.lat,lng:e.lng}),Object(a.jsx)(T.a,{positions:r.concat(e)})]})},B=n(14),I=n.n(B),L=n(19),A=n(16),E=n.n(A),N=1608802672283,F=function(t){return new Promise((function(e){return setTimeout(e,t)}))};function V(t){var e=Date.now(),n=Object(r.useState)(!1),i=Object(c.a)(n,2),o=i[0],s=i[1];return Object(a.jsxs)("div",{className:E.a.bottomMenu,children:[Object(a.jsxs)("div",{className:E.a.menuContent,children:[Object(a.jsxs)("p",{className:E.a.dates,children:[new Date(t.currentPosition.timestamp).toLocaleString(),null!=t.currentPosition.temperature?" | ".concat(t.currentPosition.temperature,"\xbaC"):null," | ",t.nextPort?"".concat(t.nextPort.city," (").concat(t.nextPort.country,")"):null]}),Object(a.jsx)("input",{type:"range",min:N,max:e,value:t.currentPosition.timestamp,onChange:function(e){var n=parseInt(e.target.value);t.onChange(n)}}),Object(a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},onClick:Object(L.a)(I.a.mark((function n(){var a;return I.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!o){n.next=2;break}return n.abrupt("return");case 2:s(!0),a=N;case 4:if(!(a<e)){n.next=12;break}return n.next=7,F(100);case 7:console.log("Is playing",o),t.onChange(a);case 9:a+=36e5,n.next=4;break;case 12:s(!1);case 13:case"end":return n.stop()}}),n)}))),children:[Object(a.jsx)("button",{children:"Ver el viaje"}),Object(a.jsxs)("p",{className:E.a.countDown,children:["Patri llega en ",t.daysToPatri," d\xedas"]})]}),Object(a.jsx)("progress",{value:(new Date).getTime()-t.patriDeparture.getTime(),max:t.patriArrival.getTime()-t.patriDeparture.getTime(),className:E.a.progress})]}),Object(a.jsx)("div",{className:E.a.overlay})]})}var z=new Date(2021,3,10),R=new Date(2020,11,22,22,0,0),G=Object(p.a)(z,new Date);var K=function(){var t=g(),e=t.timeSnapshots,n=t.lastTimeSnapshot,i=Object(r.useState)(n),o=Object(c.a)(i,2),s=o[0],u=o[1];if(Object(r.useEffect)((function(){u(n)}),[n]),!s)return Object(a.jsx)("div",{children:Object(a.jsx)("p",{children:"Cargando..."})});var p,f,d=function(t){return t.map((function(t){return t.position}))}((p=e,f=new Date(s.timestamp),p.filter((function(t){return t.timestamp<=f.getTime()})))),b=m.find((function(t){return t.id===s.arrivalPortId}));return Object(a.jsxs)("div",{className:l.a.map,children:[Object(a.jsx)(k,{currentPosition:s.position,nextPortPosition:null===b||void 0===b?void 0:b.position,positions:d}),Object(a.jsx)(V,{currentPosition:s,nextPort:b,onChange:function(t){var n=v(e,new Date(t)),a=function(t,e,n){var a=h({lat:t.position.lat,lng:t.position.lng,timestamp:t.timestamp},{lat:e.position.lat,lng:e.position.lng,timestamp:e.timestamp},n.getTime());return{timestamp:n.getTime(),position:{lat:a.lat,lng:a.lng},temperature:t.temperature,arrivalPortId:t.arrivalPortId}}(n.left,n.right,new Date(t));u(a)},daysToPatri:G,patriDeparture:R,patriArrival:z})]})},Q=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,52)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,i=e.getLCP,o=e.getTTFB;n(t),a(t),r(t),i(t),o(t)}))},q=n(29),U=n(30);function X(t){return Object.values(t).map((function(t){var e,n=t.data;return{position:{lat:n.lat,lng:n.lon},arrivalPortId:null===(e=n.arrivalPort)||void 0===e?void 0:e.id,timestamp:1e3*n.lastPos,temperature:n.windTemperature||0}}))}var Y=n(23);Y.a.initializeApp({apiKey:"AIzaSyBThWjVqdQVhkOm-P4VwtOkK1XvoQBFjBs",authDomain:"patri-chaser.firebaseapp.com",databaseURL:"https://patri-chaser-default-rtdb.europe-west1.firebasedatabase.app",projectId:"patri-chaser",storageBucket:"patri-chaser.appspot.com",messagingSenderId:"191999461469",appId:"1:191999461469:web:d17e4c14ed1ea2f1e0a5b4",measurementId:"G-YL17SVHMQY"}),Y.a.analytics();var J=Y.a,Z=new(function(){function t(){Object(q.a)(this,t),this.locationsCollection=void 0;var e=J.firestore();this.locationsCollection=e.collection("locations")}return Object(U.a)(t,[{key:"getLastTimeSnapshot",value:function(){var t=Object(L.a)(I.a.mark((function t(){var e,n,a;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.locationsCollection.orderBy("timestamp","desc").limit(1).get();case 2:return e=t.sent,n=e.docs.map((function(t){return t.data()})),a=X(n),t.abrupt("return",a[0]);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getTimeSnapshots",value:function(){var t=Object(L.a)(I.a.mark((function t(){var e;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.e(4).then(n.t.bind(null,53,3));case 2:return e=t.sent,t.abrupt("return",X(e.default));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"subscribeToNewerLocations",value:function(t,e){this.locationsCollection.orderBy("timestamp").where("timestamp",">",t.getTime()).onSnapshot((function(t){var n=X(t.docs.map((function(t){return t.data()})));e(n)}))}}]),t}());s.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(d.Provider,{value:Z,children:Object(a.jsx)(K,{})})}),document.getElementById("root")),Q()}},[[46,1,2]]]);
//# sourceMappingURL=main.b6886621.chunk.js.map