{"version":3,"sources":["components/BottomMenu.module.css","App.module.css","utils/portsMapInfo.ts","hooks/useRepositories.ts","hooks/useTimeSnapshots.ts","utils/estimateCoordinatesAtTime.ts","utils/findIndexNearestTo.ts","models/TimeSnapshots.ts","utils/portIsTooClose.ts","components/CenterOnLocationChange.tsx","components/PatriMap.tsx","components/BottomMenu.tsx","App.tsx","models/TimeSnapshot.ts","reportWebVitals.ts","utils/mapFirebaseData.tsx","firebase/firebase.ts","config/firebase.ts","index.tsx","repositories/RepositoriesImpl.ts"],"names":["module","exports","portsMapInfo","id","country","city","position","lat","lng","RepositoriesContext","createContext","useTimeSnapshots","useState","timeSnapshots","setTimeSnapshots","timeSnapshotsFromListener","setTimeSnapshotsFromListener","repositories","useContext","Error","useRepositories","useEffect","last","length","newer","filter","el","timestamp","console","log","Promise","resolve","then","getLastTimeSnapshot","timeSnapshot","getTimeSnapshots","Date","lastTimestamp","subscribeToNewerLocations","lastTimeSnapshot","estimateCoordinatesAtTime","p2","p1","angle","distanceLatitude","distanceLongitude","Math","atan2","calculateAngle","distanceTraveledEstimation","b","a","distance","sqrt","pow","timeTookDistance","calculateSpeed","calculateDuration","cos","sin","binarySearch","locations","middle","floor","lowerPart","slice","upperPart","findIndexNearestTo","element","indexOf","timeSnapshotsFindBoundingSnapshotsForTimestamp","self","date","index","findBoundingPointsForTimestamp","getTime","left","right","portIsTooClose","currentPosition","portPosition","CenterOnLocationChange","map","useMap","zoom","getZoom","setView","PatriIcon","L","icon","iconUrl","process","iconSize","iconAnchor","DestinationIcon","PatriMap","nextPortPosition","positions","MapContainer","center","TileLayer","attribution","url","Marker","Polyline","concat","MIN_TIME_RANGE","sleep","ms","r","setTimeout","BottomMenu","props","MAX_TIME_RANGE","now","isPlaying","setIsPlaying","className","styles","bottomMenu","menuContent","dates","toLocaleString","temperature","nextPort","type","min","max","value","onChange","e","parseInt","target","style","display","alignItems","gap","onClick","i","countDown","daysToPatri","patriDeparture","patriArrival","progress","overlay","PATRI_ARRIVAL_DATE","PATRI_DEPARTURE_DATE","DATS_TO_PATRI","differenceInDays","App","currentTimeSnapshot","setCurrentTimeSnapshot","polyLinePositions","s","timeSnapshotsGetPositions","find","port","arrivalPortId","bounds","snapshot","other","time","coords","timeSnapshotEstimateAtTime","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","mapFirebaseData2","data","Object","values","lon","arrivalPort","lastPos","windTemperature","firebase1","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","analytics","firebase","locationsCollection","db","firestore","this","collection","orderBy","limit","get","querySnapshot","docs","newerLocations","default","afterDate","callback","where","onSnapshot","ReactDOM","render","StrictMode","Provider","document","getElementById"],"mappings":"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","file":"static/js/main.b6886621.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"bottomMenu\":\"BottomMenu_bottomMenu__2KZEQ\",\"menuContent\":\"BottomMenu_menuContent__1dDXV\",\"dates\":\"BottomMenu_dates__3kBXF\",\"overlay\":\"BottomMenu_overlay__2ATTf\",\"countDown\":\"BottomMenu_countDown__LY052\",\"progress\":\"BottomMenu_progress__1iv3f\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"map\":\"App_map__3Febj\"};","import { LatLngLiteral } from \"leaflet\";\n\nexport type PortInfo = {\n  id: string;\n  position: LatLngLiteral;\n  country: string;\n  city: string;\n};\n\nexport const portsMapInfo: PortInfo[] = [\n  {\n    id: \"3302\",\n    country: \"España\",\n    city: \"Algeciras\",\n    position: {\n      lat: 36.17549129756906,\n      lng: -5.418971717099447,\n    },\n  },\n  {\n    id: \"21826\",\n    country: \"España\",\n    city: \"Algeciras\",\n    position: {\n      lat: 36.17549129756906,\n      lng: -5.418971717099447,\n    },\n  },\n  {\n    id: \"343\",\n    country: \"Suecia\",\n    city: \"Malmo\",\n    position: {\n      lat: 55.617983507540984,\n      lng: 13.001871231147542,\n    },\n  },\n  {\n    id: \"233\",\n    country: \"Polonia\",\n    city: \"Gdynia\",\n    position: {\n      lat: 54.54480274086806,\n      lng: 18.509637289041667,\n    },\n  },\n  {\n    id: \"22450\",\n    country: \"Polonia\",\n    city: \"Puerto de Gdynia\",\n    position: {\n      lat: 54.54480274086806,\n      lng: 18.509637289041667,\n    },\n  },\n  {\n    id: \"771\",\n    country: \"Lituania\",\n    city: \"Klaipėda\",\n    position: {\n      lat: 55.714,\n      lng: 21.11567,\n    },\n  },\n  {\n    id: \"251\",\n    country: \"Irlanda\",\n    city: \"Greenore\",\n    position: {\n      lat: 54.034677,\n      lng: -6.133334,\n    },\n  },\n  {\n    id: \"21652\",\n    country: \"Irlanda\",\n    city: \"Ringaskiddy\",\n    position: {\n      lat: 51.83541,\n      lng: -8.330348,\n    },\n  },\n  {\n    id: \"2036\",\n    country: \"Países Bajos\",\n    city: \"Róterdam\",\n    position: {\n      lat: 51.943305,\n      lng: 4.141812,\n    },\n  },\n];\n","import { createContext, useContext } from \"react\";\nimport { Repositories } from \"../repositories/Repositories\";\n\nexport const RepositoriesContext = createContext<Repositories | null>(null);\n\nexport function useRepositories() {\n  const repositories = useContext(RepositoriesContext);\n\n  if (!repositories) {\n    throw new Error(\"useRepositories must be used within RepositoriesContext\");\n  }\n\n  return { repositories };\n}\n","import { useEffect, useState } from \"react\";\nimport { useRepositories } from \"./useRepositories\";\nimport { TimeSnapshot } from \"../models/TimeSnapshot\";\nimport { TimeSnapshots } from \"../models/TimeSnapshots\";\n\nexport function useTimeSnapshots(): {\n  timeSnapshots: TimeSnapshots;\n  lastTimeSnapshot: TimeSnapshot | null;\n} {\n  const [timeSnapshots, setTimeSnapshots] = useState<TimeSnapshots>([]);\n  const [\n    timeSnapshotsFromListener,\n    setTimeSnapshotsFromListener,\n  ] = useState<TimeSnapshots>([]);\n  const { repositories } = useRepositories();\n\n  useEffect(() => {\n    const last = timeSnapshots[timeSnapshots.length - 1];\n    const newer = timeSnapshotsFromListener.filter(\n      (el) => el.timestamp > last.timestamp\n    );\n\n    console.log({ newer });\n\n    setTimeSnapshots([...timeSnapshots, ...newer]);\n  }, [timeSnapshotsFromListener]);\n\n  useEffect(() => {\n    Promise.resolve()\n      .then(() => repositories.getLastTimeSnapshot())\n      .then((timeSnapshot) => {\n        setTimeSnapshots([timeSnapshot]);\n      })\n      .then(() => repositories.getTimeSnapshots())\n      .then((timeSnapshots) => {\n        setTimeSnapshots(timeSnapshots);\n\n        return new Date(timeSnapshots[timeSnapshots.length - 1].timestamp);\n      })\n      .then((lastTimestamp) => {\n        repositories.subscribeToNewerLocations(\n          lastTimestamp,\n          setTimeSnapshotsFromListener\n        );\n      });\n  }, []);\n\n  const lastTimeSnapshot = timeSnapshots[timeSnapshots.length - 1];\n\n  return { timeSnapshots, lastTimeSnapshot };\n}\n","export type PositionAtTime = {\n  lat: number;\n  lng: number;\n  timestamp: number;\n};\n\nexport function estimateCoordinatesAtTime(\n  p2: PositionAtTime,\n  p1: PositionAtTime,\n  timestamp: number\n): PositionAtTime {\n  const angle = calculateAngle(p1, p2);\n  const speed = calculateSpeed(p1, p2);\n\n  const duration = calculateDuration(timestamp, p1);\n\n  const distanceTraveledEstimation = speed * duration;\n\n  const lat = Math.cos(angle) * distanceTraveledEstimation + p1.lat;\n  const lng = Math.sin(angle) * distanceTraveledEstimation + p1.lng;\n\n  return { lat, lng, timestamp };\n}\n\nfunction calculateSpeed(p1: PositionAtTime, p2: PositionAtTime) {\n  const b = p2.lat - p1.lat;\n  const a = p2.lng - p1.lng;\n\n  const distance = Math.sqrt(Math.pow(b, 2) + Math.pow(a, 2));\n  const timeTookDistance = p2.timestamp - p1.timestamp;\n\n  return distance / timeTookDistance;\n}\n\nfunction calculateAngle(p1: PositionAtTime, p2: PositionAtTime) {\n  const distanceLatitude = p2.lat - p1.lat;\n  const distanceLongitude = p2.lng - p1.lng;\n\n  return Math.atan2(distanceLongitude, distanceLatitude);\n}\n\nfunction calculateDuration(timestamp: number, p1: PositionAtTime) {\n  return timestamp - p1.timestamp;\n}\n","function binarySearch<T extends { timestamp: number }>(\n  locations: T[],\n  timestamp: number\n): T {\n  if (locations.length === 1) {\n    return locations[0];\n  }\n\n  const middle = Math.floor(locations.length / 2);\n\n  const lowerPart = locations.slice(0, middle);\n  const upperPart = locations.slice(middle, locations.length);\n\n  const pivot = lowerPart[lowerPart.length - 1];\n\n  if (timestamp > pivot.timestamp) {\n    return binarySearch(upperPart, timestamp);\n  } else {\n    return binarySearch(lowerPart, timestamp);\n  }\n}\n\nexport function findIndexNearestTo<T extends { timestamp: number }>(\n  locations: T[],\n  timestamp: number\n) {\n  const element = binarySearch(locations, timestamp);\n\n  return locations.indexOf(element) - 1;\n}\n\nexport function findBoundingPointsForTimestamp<T extends { timestamp: number }>(\n  locations: T[],\n  timestamp: number\n) {\n  const index = findIndexNearestTo(locations, timestamp);\n\n  const p1 = locations[index];\n  const p2 = locations[index + 1];\n\n  if (!p2) {\n    return {\n      p1,\n      p2: p1,\n    };\n  }\n\n  return { p1, p2 };\n}\n","import { TimeSnapshot } from \"./TimeSnapshot\";\nimport { Positions } from \"./Positions\";\nimport { findBoundingPointsForTimestamp } from \"../utils/findIndexNearestTo\";\n\nexport type TimeSnapshots = TimeSnapshot[];\n\nexport function timeSnapshotsBefore(\n  self: TimeSnapshots,\n  date: Date\n): TimeSnapshots {\n  return self.filter((e) => e.timestamp <= date.getTime());\n}\n\nexport function timeSnapshotsGetPositions(self: TimeSnapshots): Positions {\n  return self.map((s) => s.position);\n}\n\nexport function timeSnapshotsFindBoundingSnapshotsForTimestamp(\n  self: TimeSnapshots,\n  date: Date\n) {\n  const { p1, p2 } = findBoundingPointsForTimestamp(self, date.getTime());\n\n  return { left: p1, right: p2 };\n}\n","import { LatLngLiteral } from \"leaflet\";\n\nconst VERY_NEAR_EPSILON = 0.02;\n\nexport function portIsTooClose(\n  currentPosition: LatLngLiteral,\n  portPosition: LatLngLiteral\n) {\n  const a = currentPosition.lat - portPosition.lat;\n  const b = currentPosition.lng - portPosition.lng;\n\n  const distance = Math.sqrt(a * a + b * b);\n\n  return distance < VERY_NEAR_EPSILON;\n}\n","import { FC, useEffect } from \"react\";\nimport { useMap } from \"react-leaflet\";\n\nexport const CenterOnLocationChange: FC<{ lat: number; lng: number }> = ({\n  lat,\n  lng,\n}) => {\n  const map = useMap();\n\n  useEffect(() => {\n    const zoom = map.getZoom();\n    map.setView({ lat, lng }, zoom);\n  }, [lat, lng]);\n\n  return null;\n};\n","import React, { FC } from \"react\";\nimport L from \"leaflet\";\nimport { MapContainer, Marker, Polyline, TileLayer } from \"react-leaflet\";\nimport { Position } from \"../models/MyPosition\";\nimport { portIsTooClose } from \"../utils/portIsTooClose\";\nimport { CenterOnLocationChange } from \"./CenterOnLocationChange\";\nimport \"./PatriMap.module.css\";\n\nconst PatriIcon = L.icon({\n  iconUrl: process.env.PUBLIC_URL + \"/patri.png\",\n  iconSize: [40, 40],\n  iconAnchor: [20, 20],\n});\n\nconst DestinationIcon = L.icon({\n  iconUrl: process.env.PUBLIC_URL + \"/tracking.png\",\n  iconSize: [32, 32],\n  iconAnchor: [16, 16],\n});\n\ntype PatriMapProps = {\n  currentPosition: Position;\n  nextPortPosition?: Position;\n  positions: Position[];\n};\n\nexport const PatriMap: FC<PatriMapProps> = ({\n  currentPosition,\n  nextPortPosition,\n  positions,\n}) => (\n  <MapContainer center={currentPosition} zoom={8}>\n    <TileLayer\n      attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n      url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n    />\n    <Marker position={currentPosition} icon={PatriIcon} />\n    {nextPortPosition && !portIsTooClose(currentPosition, nextPortPosition) ? (\n      <Marker position={nextPortPosition} icon={DestinationIcon} />\n    ) : null}\n    <CenterOnLocationChange\n      lat={currentPosition.lat}\n      lng={currentPosition.lng}\n    />\n    <Polyline positions={positions.concat(currentPosition)} />\n  </MapContainer>\n);\n","import { TimeSnapshot } from \"../models/TimeSnapshot\";\nimport { PortInfo } from \"../utils/portsMapInfo\";\nimport styles from \"./BottomMenu.module.css\";\nimport React, { useState } from \"react\";\n\nconst MIN_TIME_RANGE = 1608802672283;\nconst HOUR_IN_MILLIS = 1000 * 60 * 60;\n\nconst sleep = (ms: number) => new Promise((r) => setTimeout(r, ms));\n\nexport function BottomMenu(props: {\n  currentPosition: TimeSnapshot;\n  nextPort?: PortInfo;\n  onChange: (e: number) => void;\n  daysToPatri: number;\n  patriDeparture: Date;\n  patriArrival: Date;\n}) {\n  const MAX_TIME_RANGE = Date.now();\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  return (\n    <div className={styles.bottomMenu}>\n      <div className={styles.menuContent}>\n        <p className={styles.dates}>\n          {new Date(props.currentPosition.timestamp).toLocaleString()}\n          {props.currentPosition.temperature != null\n            ? ` | ${props.currentPosition.temperature}ºC`\n            : null}\n          {\" | \"}\n          {props.nextPort\n            ? `${props.nextPort.city} (${props.nextPort.country})`\n            : null}\n        </p>\n        <input\n          type=\"range\"\n          min={MIN_TIME_RANGE}\n          max={MAX_TIME_RANGE}\n          value={props.currentPosition.timestamp}\n          onChange={(e) => {\n            const timestamp = parseInt(e.target.value);\n            props.onChange(timestamp);\n          }}\n        />\n        <div\n          style={{ display: \"flex\", alignItems: \"center\", gap: 10 }}\n          onClick={async () => {\n            if (isPlaying) {\n              return;\n            }\n\n            setIsPlaying(true);\n\n            for (\n              let i = MIN_TIME_RANGE;\n              i < MAX_TIME_RANGE;\n              i += HOUR_IN_MILLIS\n            ) {\n              await sleep(100);\n              console.log(\"Is playing\", isPlaying);\n\n              props.onChange(i);\n            }\n\n            setIsPlaying(false);\n          }}\n        >\n          <button>Ver el viaje</button>\n          <p className={styles.countDown}>\n            Patri llega en {props.daysToPatri} días\n          </p>\n        </div>\n        <progress\n          value={new Date().getTime() - props.patriDeparture.getTime()}\n          max={props.patriArrival.getTime() - props.patriDeparture.getTime()}\n          className={styles.progress}\n        />\n      </div>\n      <div className={styles.overlay} />\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport styles from \"./App.module.css\";\nimport \"leaflet/dist/leaflet.css\";\nimport differenceInDays from \"date-fns/differenceInDays\";\nimport { portsMapInfo } from \"./utils/portsMapInfo\";\nimport { useTimeSnapshots } from \"./hooks/useTimeSnapshots\";\nimport { timeSnapshotEstimateAtTime } from \"./models/TimeSnapshot\";\nimport {\n  timeSnapshotsBefore,\n  timeSnapshotsFindBoundingSnapshotsForTimestamp,\n  timeSnapshotsGetPositions,\n} from \"./models/TimeSnapshots\";\nimport { PatriMap } from \"./components/PatriMap\";\nimport { BottomMenu } from \"./components/BottomMenu\";\n\nconst PATRI_ARRIVAL_DATE = new Date(2021, 3, 10);\nconst PATRI_DEPARTURE_DATE = new Date(2020, 11, 22, 22, 0, 0);\nconst DATS_TO_PATRI = differenceInDays(PATRI_ARRIVAL_DATE, new Date());\n\nfunction App() {\n  const { timeSnapshots, lastTimeSnapshot } = useTimeSnapshots();\n  const [currentTimeSnapshot, setCurrentTimeSnapshot] = useState(\n    lastTimeSnapshot\n  );\n\n  useEffect(() => {\n    setCurrentTimeSnapshot(lastTimeSnapshot);\n  }, [lastTimeSnapshot]);\n\n  if (!currentTimeSnapshot) {\n    return (\n      <div>\n        <p>Cargando...</p>\n      </div>\n    );\n  }\n\n  const filteredTimeSnapshots = timeSnapshotsBefore(\n    timeSnapshots,\n    new Date(currentTimeSnapshot.timestamp)\n  );\n  const polyLinePositions = timeSnapshotsGetPositions(filteredTimeSnapshots);\n\n  const nextPort = portsMapInfo.find(\n    (port) => port.id === currentTimeSnapshot.arrivalPortId\n  );\n\n  return (\n    <div className={styles.map}>\n      <PatriMap\n        currentPosition={currentTimeSnapshot.position}\n        nextPortPosition={nextPort?.position}\n        positions={polyLinePositions}\n      />\n      <BottomMenu\n        currentPosition={currentTimeSnapshot}\n        nextPort={nextPort}\n        onChange={(timestamp) => {\n          const bounds = timeSnapshotsFindBoundingSnapshotsForTimestamp(\n            timeSnapshots,\n            new Date(timestamp)\n          );\n\n          const snapshot = timeSnapshotEstimateAtTime(\n            bounds.left,\n            bounds.right,\n            new Date(timestamp)\n          );\n\n          setCurrentTimeSnapshot(snapshot);\n        }}\n        daysToPatri={DATS_TO_PATRI}\n        patriDeparture={PATRI_DEPARTURE_DATE}\n        patriArrival={PATRI_ARRIVAL_DATE}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import { Position } from \"./MyPosition\";\nimport { estimateCoordinatesAtTime } from \"../utils/estimateCoordinatesAtTime\";\n\nexport type TimeSnapshot = {\n  timestamp: number;\n  temperature: number;\n  position: Position;\n  arrivalPortId?: string;\n};\n\nexport function timeSnapshotEstimateAtTime(\n  self: TimeSnapshot,\n  other: TimeSnapshot,\n  time: Date\n): TimeSnapshot {\n  const coords = estimateCoordinatesAtTime(\n    {\n      lat: self.position.lat,\n      lng: self.position.lng,\n      timestamp: self.timestamp,\n    },\n    {\n      lat: other.position.lat,\n      lng: other.position.lng,\n      timestamp: other.timestamp,\n    },\n    time.getTime()\n  );\n\n  return {\n    timestamp: time.getTime(),\n    position: {\n      lat: coords.lat,\n      lng: coords.lng,\n    },\n    temperature: self.temperature,\n    arrivalPortId: self.arrivalPortId,\n  };\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import { VesselLocationNode } from \"../firebase/typings\";\nimport { TimeSnapshot } from \"../models/TimeSnapshot\";\n\nexport function mapFirebaseData(data: any) {\n  const rawFirebaseLocations = (Object.values(\n    data\n  ) as any) as VesselLocationNode[];\n\n  return rawFirebaseLocations\n    .map(({ data }) => ({\n      timestamp: data.lastPos * 1000,\n      lat: data.lat,\n      lng: data.lon,\n      temperature: data.windTemperature,\n      arrivalPort: data.arrivalPort,\n    }))\n    .slice(10, rawFirebaseLocations.length);\n}\n\nexport function mapFirebaseData2(data: any): TimeSnapshot[] {\n  const rawFirebaseLocations = (Object.values(\n    data\n  ) as any) as VesselLocationNode[];\n\n  return rawFirebaseLocations.map(({ data }) => ({\n    position: {\n      lat: data.lat,\n      lng: data.lon,\n    },\n    arrivalPortId: data.arrivalPort?.id,\n    timestamp: data.lastPos * 1000,\n    temperature: data.windTemperature || 0,\n  }));\n}\n","import firebase1 from \"firebase\";\nimport { firebaseConfig } from \"../config/firebase\";\n\nfirebase1.initializeApp(firebaseConfig);\nfirebase1.analytics();\n\nexport const firebase = firebase1;\nexport type FirebaseCollection = firebase1.firestore.CollectionReference<firebase1.firestore.DocumentData>;\n","export const DISABLE_FIREBASE = true;\n\nexport const firebaseConfig = {\n  apiKey: \"AIzaSyBThWjVqdQVhkOm-P4VwtOkK1XvoQBFjBs\",\n  authDomain: \"patri-chaser.firebaseapp.com\",\n  databaseURL:\n    \"https://patri-chaser-default-rtdb.europe-west1.firebasedatabase.app\",\n  projectId: \"patri-chaser\",\n  storageBucket: \"patri-chaser.appspot.com\",\n  messagingSenderId: \"191999461469\",\n  appId: \"1:191999461469:web:d17e4c14ed1ea2f1e0a5b4\",\n  measurementId: \"G-YL17SVHMQY\",\n};\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { RepositoriesContext } from \"./hooks/useRepositories\";\nimport { RepositoriesImpl } from \"./repositories/RepositoriesImpl\";\n\nconst repositories = new RepositoriesImpl();\n\nReactDOM.render(\n  <React.StrictMode>\n    <RepositoriesContext.Provider value={repositories}>\n      <App />\n    </RepositoriesContext.Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { mapFirebaseData2 } from \"../utils/mapFirebaseData\";\nimport { Repositories } from \"./Repositories\";\nimport timeSnapshotCache from \"./time-snapshot-cache.json\";\nimport { firebase, FirebaseCollection } from \"../firebase/firebase\";\nimport { TimeSnapshot } from \"../models/TimeSnapshot\";\n\nexport class RepositoriesImpl implements Repositories {\n  private locationsCollection: FirebaseCollection;\n\n  constructor() {\n    const db = firebase.firestore();\n    this.locationsCollection = db.collection(\"locations\");\n  }\n\n  async getLastTimeSnapshot(): Promise<TimeSnapshot> {\n    const querySnapshot = await this.locationsCollection\n      .orderBy(\"timestamp\", \"desc\")\n      .limit(1)\n      .get();\n\n    const data = querySnapshot.docs.map((el) => el.data());\n\n    const newerLocations = mapFirebaseData2(data);\n\n    return newerLocations[0];\n  }\n\n  async getTimeSnapshots(): Promise<TimeSnapshot[]> {\n    const data = await import(\"./time-snapshot-cache.json\");\n\n    return mapFirebaseData2(data.default);\n  }\n\n  subscribeToNewerLocations(\n    afterDate: Date,\n    callback: (locations: TimeSnapshot[]) => void\n  ): void {\n    this.locationsCollection\n      .orderBy(\"timestamp\")\n      .where(\"timestamp\", \">\", afterDate.getTime())\n      .onSnapshot((snapshot) => {\n        const newerLocations = mapFirebaseData2(\n          snapshot.docs.map((el) => el.data())\n        );\n\n        callback(newerLocations);\n      });\n  }\n}\n"],"sourceRoot":""}